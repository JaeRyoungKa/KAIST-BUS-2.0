<!DOCTYPE html>
<html lang="en">

<head>
    <title>KAIST 버스 2.0</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#413b98">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap&subset=korean" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        var array1 = [525, 535, 555, 565, 585, 595, 615, 625, 645, 655, 675, 685, 705, 775, 795, 805, 825, 835, 855, 865, 885, 895, 915, 925, 945, 955, 975, 985, 1005, 1015];
        var delay = [0, 1, 3, 4, 6, 7, 8, 9, 10, 11, 12];

        var date = new Date();

        setInterval(function() {
            date.setSeconds(date.getSeconds() + 1);
            var time = tick(date.getHours(), 2) + ":" + tick(date.getMinutes(), 2) + ":" + tick(date.getSeconds(), 2);
            $('.current_timer').text(time);

            var next_bus_val = next_bus(date.getHours(), date.getMinutes(), 0);
            if (next_bus_val == -1) {
                $("#timer_nextbus").text("운행 종료");
                $("#timer_left").text("운행 종료");
            } else {
                $("#timer_nextbus").text(tick(Math.floor(array1[next_bus_val] / 60), 2) + ":" + tick(Math.floor(array1[next_bus_val] - Math.floor(array1[next_bus_val] / 60) * 60), 2) + ":00");
                var time_left = Math.floor(array1[next_bus_val] / 60) * 3600 + Math.floor(array1[next_bus_val] - Math.floor(array1[next_bus_val] / 60) * 60) * 60 + 0 - (date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds());
                $("#timer_left").text(tick(Math.floor(time_left / 3600), 2) + ":" + tick(Math.floor((time_left - Math.floor(time_left / 3600) * 3600) / 60), 2) + ":" + tick(time_left - Math.floor(time_left / 3600) * 3600 - Math.floor((time_left - Math.floor(time_left / 3600) * 3600) / 60) * 60, 2));
            }

            $("#timer_nextbus2").text(stationTimerSetting1(delay[1], date));
            $("#timer_left2").text(stationTimerSetting2(delay[1], date));

            $("#timer_nextbus3").text(stationTimerSetting1(delay[2], date));
            $("#timer_left3").text(stationTimerSetting2(delay[2], date));

            $("#timer_nextbus4").text(stationTimerSetting1(delay[3], date));
            $("#timer_left4").text(stationTimerSetting2(delay[3], date));

            $("#timer_nextbus5").text(stationTimerSetting1(delay[4], date));
            $("#timer_left5").text(stationTimerSetting2(delay[4], date));

            $("#timer_nextbus6").text(stationTimerSetting1(delay[5], date));
            $("#timer_left6").text(stationTimerSetting2(delay[5], date));

            $("#timer_nextbus7").text(stationTimerSetting1(delay[6], date));
            $("#timer_left7").text(stationTimerSetting2(delay[6], date));

            $("#timer_nextbus8").text(stationTimerSetting1(delay[7], date));
            $("#timer_left8").text(stationTimerSetting2(delay[7], date));

            $("#timer_nextbus9").text(stationTimerSetting1(delay[8], date));
            $("#timer_left9").text(stationTimerSetting2(delay[8], date));

            $("#timer_nextbus10").text(stationTimerSetting1(delay[9], date));
            $("#timer_left10").text(stationTimerSetting2(delay[9], date));

            $("#timer_nextbus11").text(stationTimerSetting1(delay[10], date));
            $("#timer_left11").text(stationTimerSetting2(delay[10], date));


            $(".spinner-timer").hide();

        }, 1000)

        function stationTimerSetting1(offset, date) {
            var next_bus_val = next_bus(date.getHours(), date.getMinutes(), offset);
            if (next_bus_val == -1) {
                return "운행 종료";
            } else {
                var next_bus_time = array1[next_bus_val] + offset;
                return tick(Math.floor(next_bus_time / 60), 2) + ":" + tick(Math.floor(next_bus_time - Math.floor(next_bus_time / 60) * 60), 2) + ":00";
            }
        }

        function stationTimerSetting2(offset, date) {
            var next_bus_val = next_bus(date.getHours(), date.getMinutes(), offset);
            if (next_bus_val == -1) {
                return "운행 종료";
            } else {
                var next_bus_time = array1[next_bus_val] + offset;
                var time_left = Math.floor(next_bus_time / 60) * 3600 + Math.floor(next_bus_time - Math.floor(next_bus_time / 60) * 60) * 60 - (date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds());
                return tick(Math.floor(time_left / 3600), 2) + ":" + tick(Math.floor((time_left - Math.floor(time_left / 3600) * 3600) / 60), 2) + ":" + tick(time_left - Math.floor(time_left / 3600) * 3600 - Math.floor((time_left - Math.floor(time_left / 3600) * 3600) / 60) * 60, 2);
            }
        }


        function int2str(num) {
            var hr = tick(Math.floor(num / 60), 2);
            var min = tick(num - Math.floor(num / 60) * 60, 2);
            return hr + "시 " + min + "분";
        }

        function tick(num, size) {
            var s = num + "";
            while (s.length < size) s = "0" + s;

            return s;
        }

        function next_bus(hr, min, offset) {
            var cur_time = hr * 60 + min;

            for (var i = 0; i < array1.length; i++) {
                if (array1[i] + offset > cur_time) {
                    return i;
                }
            }
            return -1;
        }

        function contentsMaker(offset) {
            var contents = "";
            for (i = 0; i < array1.length; i++) {
                contents += "<tr><td>" + (i + 1) + "</td><td style='text-align: right;'>" + int2str(array1[i] + offset) + "</td></tr>";
            }
            return contents;
        }
        $(document).ready(function() {
            $('[data-toggle="tooltip_noWeekends"]').tooltip();
            $('[data-toggle="tooltip"]').tooltip();

            $('#ttProvider').append(contentsMaker(delay[0]));
            $('#ttProvider2').append(contentsMaker(delay[1]));
            $('#ttProvider3').append(contentsMaker(delay[2]));
            $('#ttProvider4').append(contentsMaker(delay[3]));
            $('#ttProvider5').append(contentsMaker(delay[4]));
            $('#ttProvider6').append(contentsMaker(delay[5]));
            $('#ttProvider7').append(contentsMaker(delay[6]));
            $('#ttProvider8').append(contentsMaker(delay[7]));
            $('#ttProvider9').append(contentsMaker(delay[8]));
            $('#ttProvider10').append(contentsMaker(delay[9]));
            $('#ttProvider11').append(contentsMaker(delay[10]));


        });

        $(function() {
            $("#header").load("./header.html");
            $("#footer").load("./footer.html");
        });
    </script>


</head>

<body>
    <div id="header"></div>


    <div class="container">
        <div class="card bg-white text-dark text-center" style="margin-top:18px; margin-bottom:18px;">
            <div class="card-body">
                <div class="container timers">
                    <div class="row">

                        <div class="card bg-white text-dark text-center" style="width:100%;">
                            <div class="card-body">
                                <div class="col-12" style="text-align: left;">
                                    <h3 style="margin-bottom:15px;">업데이트 내역</h3>
                                    <h5>2019년 8월 8일</h5>
                                    <p></p>
                                </div>
                            </div>
                        </div>

                        <div class="card bg-white text-dark text-center" style="width:100%; margin-bottom:15px;">
                            <div class="card-body">
                                <div class="col-12" style="text-align: left;">
                                    <h3 style="margin-bottom:15px;">기여한 사람들</h3>
                                    <p>Jaeryoung Ka (2019~, v2.0)</p>
                                    <p>Joonyoung Yi (2018~)</p>
                                    <p>Dongwoo Kim (2014 ~ 2017)</p>
                                </div>
                            </div>
                        </div>


                    </div>

                </div>
            </div>
        </div>
    </div>


    <div id="footer"></div>
</body>

</html>